# Краткая инструкция по языку 1С (BSL)

## Основные принципы

Язык 1С:Предприятие (BSL) — процедурный язык программирования с поддержкой ООП-элементов. Использует русские и английские ключевые слова.

## Структура модуля

### Элементы модуля

Модуль в языке 1С может содержать следующие элементы:

#### 1. Объявления переменных
```bsl
Перем ГлобальнаяПеременная Экспорт;
Перем ЛокальнаяПеременная;
```

#### 2. Процедуры и функции
```bsl
Процедура Процедура1() Экспорт
    // код процедуры
КонецПроцедуры

Функция Функция1() Экспорт
    // код функции
    Возврат Результат;
КонецФункции
```

#### 3. Области кода
```bsl
#Область ИмяОбласти
    // код области
#КонецОбласти
```

### Вложенность элементов

#### Области могут быть вложенными
```bsl
#Область ВнешняяОбласть
    // код внешней области
    
    #Область ВнутренняяОбласть
        // код внутренней области
    #КонецОбласти
    
    // еще код внешней области
#КонецОбласти
```

#### Функции и процедуры НЕ могут быть вложенными
```bsl
// ❌ НЕПРАВИЛЬНО - вложенные функции не поддерживаются
Функция ВнешняяФункция()
    Функция ВнутренняяФункция() // Ошибка!
        // код
    КонецФункции
КонецФункции

// ✅ ПРАВИЛЬНО - функции на одном уровне
Функция Функция1()
    // код
КонецФункции

Функция Функция2()
    // код
КонецФункции
```

### Организация кода в модуле

#### Общая последовательность разделов модуля:
1. **Заголовок модуля** — описание назначения
2. **Описание переменных** — объявления глобальных переменных
3. **Программный интерфейс** — экспортные процедуры и функции
4. **Обработчики событий** — обработчики событий объекта/формы
5. **Служебные процедуры и функции** — внутренняя реализация
6. **Инициализация** — инициализация переменных и объектов

#### Стандартные шаблоны областей

**Для общих модулей:**
```bsl
#Область ПрограммныйИнтерфейс
    // Экспортные процедуры и функции для внешнего использования
#КонецОбласти

#Область СлужебныйПрограммныйИнтерфейс
    // Экспортные процедуры и функции для подсистемы
#КонецОбласти

#Область СлужебныеПроцедурыИФункции
    // Внутренняя реализация модуля
#КонецОбласти
```

**Для модулей объектов, менеджеров, обработок, отчетов:**
```bsl
#Область ОписаниеПеременных
    Перем ВалютаУчета; // Валюта для отображения данных
    Перем АдресПоддержки; // Адрес службы поддержки
#КонецОбласти

#Область ПрограммныйИнтерфейс
    // Экспортные процедуры и функции
#КонецОбласти

#Область ОбработчикиСобытий
    // Обработчики событий объекта (ПриЗаписи, ПриПроведении и др.)
#КонецОбласти

#Область СлужебныйПрограммныйИнтерфейс
    // Экспортные процедуры для подсистемы
#КонецОбласти

#Область СлужебныеПроцедурыИФункции
    // Внутренняя реализация
#КонецОбласти

#Область Инициализация
    АдресПоддержки = "v8@1c.ru";
    ВыполнитьИнициализацию();
#КонецОбласти
```

**Для модулей форм:**
```bsl
#Область ОписаниеПеременных
    // Переменные формы
#КонецОбласти

#Область ОбработчикиСобытийФормы
    // События формы (ПриСозданииНаСервере, ПриОткрытии и др.)
#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы
    // События элементов основной части формы
#КонецОбласти

#Область ОбработчикиСобытийЭлементовТаблицыФормы<ИмяТаблицы>
    // События таблиц формы и их элементов
#КонецОбласти

#Область ОбработчикиКомандФормы
    // Обработчики команд формы
#КонецОбласти

#Область СлужебныеПроцедурыИФункции
    // Внутренняя реализация
#КонецОбласти
```

**Для модулей команд:**
```bsl
#Область ОбработчикиСобытий
    // Обработчик команды ОбработкаКоманды
#КонецОбласти

#Область СлужебныеПроцедурыИФункции
    // Внутренняя реализация
#КонецОбласти
```

#### Заголовок модуля
```bsl
////////////////////////////////////////////////////////////////////////////////
// Клиентские процедуры и функции общего назначения:
// - для работы со списками в формах;
// - для работы с журналом регистрации;
// - для обработки действий пользователя в процессе редактирования
//   многострочного текста, например комментария в документах;
// - прочее.
////////////////////////////////////////////////////////////////////////////////
```

#### Правила организации кода

**Разделение на подразделы:**
- Объемные разделы рекомендуется разбивать на подразделы по функциональному признаку
- Например: `#Область ОбновлениеИнформационнойБазы`

**Обработчики событий:**
- Каждое событие должно иметь свой обработчик
- Обработчики одного элемента формы располагаются вместе
- Не рекомендуется вызывать обработчики событий из кода модуля

**Комментарии к переменным:**
- Все переменные должны иметь комментарии, объясняющие их назначение
- Комментарии размещаются в той же строке, где объявляется переменная

**Пустые области:**
- В модуле не должно быть пустых областей

### Типы модулей

#### Модуль объекта
- Содержит код для работы с конкретным объектом
- Может содержать обработчики событий объекта (ПриЗаписи, ПриПроведении и др.)
- Может содержать разделы: ОписаниеПеременных, ПрограммныйИнтерфейс, ОбработчикиСобытий, СлужебныйПрограммныйИнтерфейс, СлужебныеПроцедурыИФункции, Инициализация

#### Модуль менеджера
- Содержит общие процедуры и функции для работы с объектами
- Обычно содержит статические методы
- НЕ может содержать разделы: ОписаниеПеременных, Инициализация

#### Общий модуль
- Содержит переиспользуемый код
- Может быть настроен на выполнение на клиенте/сервере
- Неглобальные общие модули НЕ могут содержать разделы: ОписаниеПеременных, Инициализация
- Разделы: ПрограммныйИнтерфейс, СлужебныйПрограммныйИнтерфейс, СлужебныеПроцедурыИФункции

#### Модуль формы
- Содержит код для работы с формами
- Содержит обработчики событий формы и элементов формы
- Разделы: ОписаниеПеременных, ОбработчикиСобытийФормы, ОбработчикиСобытийЭлементовШапкиФормы, ОбработчикиСобытийЭлементовТаблицыФормы, ОбработчикиКомандФормы, СлужебныеПроцедурыИФункции

#### Модуль команды
- Содержит обработчик команды ОбработкаКоманды
- Разделы: ОбработчикиСобытий, СлужебныеПроцедурыИФункции

#### Другие типы модулей
- **Модуль набора записей** — НЕ может содержать ОписаниеПеременных, Инициализация
- **Модуль значений констант** — НЕ может содержать ОписаниеПеременных, Инициализация  
- **Модуль сеанса** — НЕ может содержать ОписаниеПеременных, Инициализация

### Комментарии
```bsl
// Однострочный комментарий
```

## Типы данных

### Базовые типы
- `Число` / `Number` — числовые значения
- `Строка` / `String` — текстовые значения  
- `Дата` / `Date` — даты и время
- `Булево` / `Boolean` — логические значения (Истина/Ложь)
- `Неопределено` / `Undefined` — неопределенное значение
- `NULL` — пустое значение

### Коллекции
- `Массив` / `Array` — массив значений
- `Структура` / `Structure` — структура с именованными полями
- `Соответствие` / `Map` — ассоциативный массив
- `СписокЗначений` / `ValueList` — список значений
- `ТаблицаЗначений` / `ValueTable` — таблица значений
- `ДеревоЗначений` / `ValueTree` — дерево значений

### Ссылки на объекты
- `СправочникСсылка.ИмяСправочника`
- `ДокументСсылка.ИмяДокумента`
- `ПеречислениеСсылка.ИмяПеречисления`

## Объявления

### Переменные
```bsl
Перем ИмяПеременной Экспорт;
Перем ИмяПеременной;
```

### Процедуры
```bsl
Процедура ИмяПроцедуры(Параметр1, Параметр2 = ЗначениеПоУмолчанию) Экспорт
    // код процедуры
КонецПроцедуры
```

### Функции
```bsl
Функция ИмяФункции(Параметр1, Параметр2) Экспорт
    // код функции
    Возврат Результат;
КонецФункции
```

## Детали сигнатур функций и процедур

### Аргументы по умолчанию
```bsl
// Параметр с значением по умолчанию
Функция Пример(ОбязательныйПараметр, НеобязательныйПараметр = "ЗначениеПоУмолчанию")
    // код
КонецФункции

// Вызовы:
Пример("Обязательный"); // НеобязательныйПараметр = "ЗначениеПоУмолчанию"
Пример("Обязательный", "НовоеЗначение"); // НеобязательныйПараметр = "НовоеЗначение"
```

### Передача аргументов

#### По ссылке (по умолчанию)
```bsl
Функция ОбработатьПоСсылке(Параметр) // Без ключевого слова Знач
    // код функции
КонецФункции
```

#### По значению
```bsl
Функция ОбработатьПоЗначению(Знач Параметр)
    // код функции
КонецФункции
```

### Типизация параметров
```bsl
// Типы указываются только в комментариях
// Параметры:
//  ТекстСтроки - Строка
//  МаксимальнаяДлина - Число, Неопределено
Функция ОбработатьСтроку(Знач ТекстСтроки, Знач МаксимальнаяДлина = 100)
    // код функции
КонецФункции

// Возвращаемое значение:
//  - Строка
Функция ПолучитьФорматированныйТекст(Знач ИсходныйТекст)
    Возврат СокрЛП(ИсходныйТекст);
КонецФункции

// Пример сложной типизации из реального кода:
// Параметры:
//  Дата - Дата
//  Контрагент - СправочникСсылка.Контрагенты
//  СуммаРаспределенияПоЛС - Число
//  ДокументОплаты - ДокументСсылка
//  Организация - СправочникСсылка.Организации
//  СписокЛицевыхСчетов - СписокЗначений из СправочникСсылка.КВП_ЛицевыеСчета
// Возвращаемое значение:
//  - ТаблицаЗначений
//      * Объект - СправочникСсылка.КВП_ЛицевыеСчета
//      * ДокументОплаты - ДокументСсылка
//      * Сумма - Число
//      * Помещение - СправочникСсылка.УПЖКХ_Помещения
//      * Здание - СправочникСсылка.КВП_Здания
//      * Владелец - СправочникСсылка.Контрагенты
Функция СформироватьТаблицуОплатПоКонтрагенту(Знач Дата, Знач Контрагент,
        Знач СуммаРаспределенияПоЛС, Знач ДокументОплаты, Знач Организация, Знач СписокЛицевыхСчетов) Экспорт
    // код функции
КонецФункции
```

### Возвращаемые значения функций

#### Простые типы
```bsl
Функция ПолучитьСумму(Знач Число1, Знач Число2)
    Возврат Число1 + Число2; // Возвращает число
КонецФункции

Функция ПолучитьТекст(Знач Префикс)
    Возврат Префикс + "_дополнение"; // Возвращает строку
КонецФункции
```

#### Сложные типы
```bsl
Функция СоздатьСтруктуру(Знач Имя, Знач Возраст)
    Результат = Новый Структура("Имя, Возраст");
    Результат.Имя = Имя;
    Результат.Возраст = Возраст;
    Возврат Результат; // Возвращает структуру
КонецФункции

Функция ПолучитьСписокЭлементов()
    Результат = Новый Массив;
    Результат.Добавить("Элемент1");
    Результат.Добавить("Элемент2");
    Возврат Результат; // Возвращает массив
КонецФункции
```

### Модификаторы доступа

#### Экспорт
```bsl
Функция ПубличнаяФункция() Экспорт
    // Функция доступна из других модулей
КонецФункции
```

#### Без модификатора (приватная)
```bsl
Функция ПриватнаяФункция()
    // Функция доступна только внутри текущего модуля
КонецФункции
```

### Примеры сложных сигнатур
```bsl
// Функция с множественными параметрами по умолчанию
Функция СоздатьДокумент(
    Знач Наименование,
    Знач Дата = ТекущаяДата(),
    Знач Сумма = 0,
    Знач Активен = Истина,
    Знач Описание = "")
    
    // код создания документа
КонецФункции

// Функция с параметрами по ссылке и значению
Функция ОбработатьТаблицу(
    ТаблицаДанных, // По ссылке (по умолчанию)
    Знач МаксимальноеКоличество = 1000) // По значению
    
    // Обработка таблицы
КонецФункции

// Функция с возвратом структуры
Функция ПолучитьРезультатОбработки(Знач ВходныеДанные) Экспорт
    Результат = Новый Структура("Успех, Сообщение, Данные");
    
    Попытка
        // Обработка данных
        Результат.Успех = Истина;
        Результат.Данные = ОбработанныеДанные;
    Исключение
        Результат.Успех = Ложь;
        Результат.Сообщение = ОписаниеОшибки();
    КонецПопытки
    
    Возврат Результат;
КонецФункции
```

## Управляющие конструкции

### Условия
```bsl
Если Условие Тогда
    // код
ИначеЕсли ДругоеУсловие Тогда
    // код
Иначе
    // код
КонецЕсли
```

### Циклы
```bsl
// Цикл по коллекции
Для Каждого Элемент Из Коллекция Цикл
    // код
КонецЦикла

// Цикл с счетчиком
Для Счетчик = Начало По Конец Цикл
    // код
КонецЦикла

// Цикл с условием
Пока Условие Цикл
    // код
КонецЦикла
```

### Обработка ошибок
```bsl
Попытка
    // код, который может вызвать ошибку
Исключение
    // обработка ошибки
КонецПопытки
```

## Операторы

### Арифметические
- `+` — сложение
- `-` — вычитание  
- `*` — умножение
- `/` — деление
- `%` — остаток от деления

### Логические
- `И` / `And` — логическое И
- `Или` / `Or` — логическое ИЛИ
- `Не` / `Not` — логическое НЕ

### Сравнения
- `=` — равно
- `<>` — не равно
- `<` — меньше
- `>` — больше
- `<=` — меньше или равно
- `>=` — больше или равно

### Тернарный оператор
```bsl
?(Условие, ЗначениеЕслиИстина, ЗначениеЕслиЛожь)
```

## Работа с объектами

### Создание объектов
```bsl
Новый ТипОбъекта()
Новый ТипОбъекта(Параметр1, Параметр2)
```

### Обращение к свойствам и методам
```bsl
Объект.Свойство
Объект.Метод(Параметры)
```

## Директивы компиляции

### Области видимости
- `&НаКлиенте` — код выполняется на клиенте
- `&НаСервере` — код выполняется на сервере
- `&НаКлиентеНаСервере` — код выполняется везде

### Препроцессор
```bsl
#Если Условие Тогда
    // код
#ИначеЕсли ДругоеУсловие Тогда
    // код
#Иначе
    // код
#КонецЕсли
```

## Аннотации (для расширений)

```bsl
&Перед("ИмяМетода")
&После("ИмяМетода") 
&Вместо("ИмяМетода")
&ИзменениеИКонтроль("ИмяМетода")
```

## Работа с запросами

```bsl
Запрос = Новый Запрос;
Запрос.Текст = "ВЫБРАТЬ * ИЗ Справочник.Контрагенты";
Запрос.УстановитьПараметр("Параметр", Значение);
Результат = Запрос.Выполнить();
Таблица = Результат.Выгрузить();
```

## Основные функции

### Работа со строками
- `СокрЛП()` — убрать пробелы слева и справа
- `СтрДлина()` — длина строки
- `СтрЗаменить()` — замена в строке
- `СтрШаблон()` — форматирование строки

### Работа с датами
- `ТекущаяДата()` — текущая дата
- `ДобавитьМесяц()` — добавить месяцы к дате
- `ДобавитьДень()` — добавить дни к дате

### Работа с коллекциями
- `.Количество()` — количество элементов
- `.Добавить()` — добавить элемент
- `.Найти()` — найти элемент
- `.Удалить()` — удалить элемент

## Стиль кодирования

### Именование
- Переменные и функции: `ИмяПеременной`
- Константы: `ИМЯ_КОНСТАНТЫ`
- Области: `#Область ИмяОбласти`

### Структура кода
1. Объявления переменных
2. Процедуры и функции
3. Основной код

### Документирование функций (дополнение сигнатуры)

Комментарии с описанием параметров и возвращаемых значений фактически дополняют сигнатуру функции для IDE:

```bsl
// Описание назначения функции
// Параметры:
//  Дата - Дата
//  Контрагент - СправочникСсылка.Контрагенты
//  СуммаРаспределенияПоЛС - Число
//  ДокументОплаты - ДокументСсылка
//  Организация - СправочникСсылка.Организации
//  СписокЛицевыхСчетов - СписокЗначений из СправочникСсылка.КВП_ЛицевыеСчета
// Возвращаемое значение:
//  - ТаблицаЗначений
//      * Объект - СправочникСсылка.КВП_ЛицевыеСчета
//      * ДокументОплаты - ДокументСсылка
//      * Сумма - Число
//      * Помещение - СправочникСсылка.УПЖКХ_Помещения
//      * Здание - СправочникСсылка.КВП_Здания
//      * Владелец - СправочникСсылка.Контрагенты
Функция СформироватьТаблицуОплатПоКонтрагенту(Знач Дата, Знач Контрагент,
        Знач СуммаРаспределенияПоЛС, Знач ДокументОплаты, Знач Организация, Знач СписокЛицевыхСчетов) Экспорт
    // код функции
КонецФункции
```

#### Элементы документирования:

**Описание функции** — краткое описание назначения  
**Параметры** — список параметров с типами и описанием  
**Возвращаемое значение** — тип возвращаемого значения, для сложных типов — структура полей  

#### Преимущества документирования:
- **IDE поддержка** — автодополнение, подсказки типов
- **Читаемость кода** — понятная сигнатура функции
- **Документация** — автоматическая генерация документации
- **Рефакторинг** — легче изменять и поддерживать код

## Типичные паттерны

### Проверка на заполненность
```bsl
Если ЗначениеЗаполнено(Переменная) Тогда
    // код
КонецЕсли
```

### Проверка типа
```bsл
Если ТипЗнч(Переменная) = Тип("Строка") Тогда
    // код
КонецЕсли
```

### Работа с таблицами значений
```bsl
Таблица = Новый ТаблицаЗначений;
Таблица.Колонки.Добавить("Колонка", Новый ОписаниеТипов("Строка"));
НоваяСтрока = Таблица.Добавить();
НоваяСтрока.Колонка = "Значение";
```

Это основные правила и конструкции языка 1С:Предприятие (BSL). Для более детального изучения рекомендуется обратиться к официальной документации. 